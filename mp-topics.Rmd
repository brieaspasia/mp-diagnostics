---
title: "mp-topics"
author: "Brie Sherow"
date: "13/07/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load libraries}
library(bibliometrix)
library(igraph)

```


```{r upload data, eval=TRUE}
getwd()

bib <- convert2df(file = c("./data/scopus2018-2019.bib","./data/scopus2015-2017.bib", "./data/scopus2011-2014.bib","./data/scopus2006-2010.bib", "./data/scopus1999-2005.bib","./data/scopus1970-1998.bib"), dbsource = "scopus", format = "bibtex") # Convert to a bibliometric data frame

# bib <- convert2df(file = c("./data/scopus2015-2017.bib"), dbsource = "scopus", format = "bibtex") # Test file

# names(bib)
#write.csv(bib, "output/bib_as_df.csv", row.names = FALSE) #save this data frame as a csv file
```

```{r networks}
NetMatrix <- biblioNetwork(bib, analysis = "co-occurrences", network = "keywords", sep = ";")
net=networkPlot(NetMatrix, normalize="association", n = 30, Title = "Keyword Co-occurrences", type = "fruchterman", size.cex=TRUE, size=20, remove.multiple=F, edgesize = 10, labelsize=3,label.cex=TRUE,label.n=30,edges.min=2)

```


```{r converting from matrix}
#convert to simple matrix
NetMatrix2 <- as.matrix(NetMatrix)

#convert to data frame
NetMatrix3 <- as.data.frame(NetMatrix2)

#add a column with university names from the rownames
NetMatrix3$Keyword <- rownames(NetMatrix3)
head(NetMatrix3$Keyword)

#reformat into long df
library(tidyverse)
out <- gather(NetMatrix3, key = COL_NAME, value = Linkscount, -Keyword)

summary(out$Linkscount)

#filter out unlinked
out <- out %>%
  filter(Linkscount > 5)

#filter out self matches
out <- out[!(out$Keyword==out$COL_NAME),]

#ensuring no duplicated edges or self-loops
library(igraph)
gD <- simplify(graph.data.frame(out, directed=FALSE))

#inspect the data
V(gD) #prints the list of vertices (keywords)
E(gD) #prints the list of edges (relationships)
degree <- degree(gD) #print the number of edges per vertex (relationships per keyword)
```

```{r wordcloud}
library(wordcloud)
library(wordcloud2)

?wordcloud2

#creating df for wordcloud
cloud_plot <- as.data.frame(degree)
cloud_plot$word <- rownames(cloud_plot)
rownames(cloud_plot) <- NULL
colnames(cloud_plot)[colnames(cloud_plot) == "degree"] <- "freq"

cloud_plot <- cloud_plot[,c(2,1)]

pal2 <- brewer.pal(8,"Dark2")

wordcloud(cloud_plot$freq,cloud_plot$word, scale=c(2,.2),min.freq=100,
max.words=100, random.order=FALSE, rot.per=.15, colors=pal2)

wordcloud2(cloud_plot, size=1)
```

```{r initial igraph plot}
# First try - hairball!
plot(gD)
```


```{r subset data}
#subset based on degree
bad.vs<-V(gD)[degree(gD)<300] #identify vertices with fewer connections
gD<-delete.vertices(gD, bad.vs) #exclude them from the graph

plot(gD) #another hairball...
```



```{r analysis and summary}
results <- biblioAnalysis(bib, sep=";")

# options(width=100)
# S <- summary(object = results, k = 10, pause = FALSE)
```

```{r co-word through correspondence}

CS <- conceptualStructure(bib, method="MCA", field="ID", minDegree=10, clust="auto", stemming=FALSE, labelsize=8, documents=20)

```



