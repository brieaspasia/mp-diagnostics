---
title: "mp-mapping"
author: "Brie Sherow"
date: "08/07/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

```{r figure-setup, echo=FALSE, include=FALSE}
knitr::opts_chunk$set(fig.path="output/", fig.width=11, fig.height=9.5, fig.align="center")
#reference:https://geocompr.robinlovelace.net/adv-map.html#static-maps
```

```{r install tmap and load data}
# install.packages("tmaptools")
# install.packages("tmap")
library(tmaptools)
library(tmap)
library(sf)
library(bibliometrix)
data("World")
```


```{r upload data, eval=TRUE}
# getwd()
# bib <- convert2df(file = c("./data/scopus2015-2017.bib"), dbsource = "scopus", format = "bibtex") # Convert one file to biblio df for testing

bib <- convert2df(file = c("./data/scopus2018-2019.bib","./data/scopus2015-2017.bib", "./data/scopus2011-2014.bib","./data/scopus2006-2010.bib", "./data/scopus1999-2005.bib","./data/scopus1970-1998.bib"), dbsource = "scopus", format = "bibtex") # Convert all files to a bibliometric data frame

# names(bib)

#write.csv(bib, "output/bib_as_df.csv", row.names = FALSE) #save this data frame as a csv file
```

```{r analysis and summary}
results <- biblioAnalysis(bib, sep=";")

options(width=100)
S <- summary(object = results, k=25, pause = FALSE)

```

```{r extract country level data}
#isolate the country data
MostProdCountries <- print(S$MostProdCountries)
MostProdCountries$Articles <- as.numeric(MostProdCountries$Articles)
MostProdCountries$article_prop <- (MostProdCountries$Articles/9728)*100

sum(MostProdCountries$article_prop[1:10]) #the top ten countries produce 45% of the articles
```

```{r join bib to world}
#join the bib country data to the world spatial file
#I need a better way to do this, because this way won't update if the order changes

# #test 2015-2017 dataset
# iso_a3 <- c("USA", "ITA", "CHN", "BRA", "ESP", "KOR", "GBR", "FRA", "DEU", "AUS")

#full dataset top 10
iso_a3 <- c("USA", "CHN", "ITA", "ESP", "GBR", "CAN", "AUS", "JPN",  "BRA",  "FRA")

#full dataset top 25 -- HongKong isn't a real iso_a3, I've just added it as a placeholder here
iso_a3 <- c("USA", "CHN", "ITA", "ESP", "GBR", "CAN", "AUS", "JPN",  "BRA",  "FRA", "DEU", "KOR", "HONGKONG", "IND", "NOR", "PRT", "GRC", "TUR", "SWE", "NLD", "DNK", "BEL", "MEX", "POL", "ARG")

MostProdCountries$iso_a3 <- iso_a3

#Attempt to join Summary to spatial data -- didn't work
# test <- append_data(World, MostProdCountries, key.shp = "name", key.data = "Country",
#   ignore.duplicates = FALSE, ignore.na = FALSE,
#   fixed.order = is.null(key.data) && is.null(key.shp))

#Example joining df to spatial data
#append_data(shp, data, key.shp = NULL, key.data = NULL,
#  ignore.duplicates = FALSE, ignore.na = FALSE,
# fixed.order = is.null(key.data) && is.null(key.shp))

#Joining summary to spatial data
final <- dplyr::full_join(World, MostProdCountries, by="iso_a3")

final$Articles <- as.numeric(final$Articles)

```

```{r colour-map, fig.cap='Top ten countries producing marine pollution research by proportion'}

#Mapping by proportion of articles
tm_shape(final) + tm_fill(col = "article_prop")


```
```{r colour-map, fig.cap='Top ten countries producing marine pollution research by total articles'}

#Mapping by total number of articles
tm_shape(final) + tm_fill(col = "Articles")


```


```{r mapping by symbol}
tm_shape(final) +
  tm_polygons() +
  tm_symbols(col="blue", size = "article_prop")

?tm_symbols
```

